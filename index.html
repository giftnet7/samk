<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíçWedding Gallery</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Cormorant+Garamond:wght@300;400;500;600&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Custom Fonts and Animation Styling */
        * {
            font-family: 'Montserrat', sans-serif;
        }
        .script-font {
            font-family: 'Great Vibes', cursive;
        }
        .serif-font {
            font-family: 'Cormorant Garamond', serif;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        .heartbeat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #fff 0%, transparent 70%);
            border-radius: 50%;
            animation: sparkle 2s ease-in-out infinite;
        }
        .photo-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .photo-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .photo-card:hover img {
            transform: scale(1.1);
        }
        .photo-card img {
            transition: transform 0.6s ease;
        }
        .category-btn.active {
            background: linear-gradient(135deg, #b76e79 0%, #c9a87c 100%);
            color: white;
        }
        /* Masonry Layout for Gallery */
        .gallery-masonry {
            column-count: 3;
            column-gap: 1.5rem;
        }
        @media (max-width: 1024px) {
            .gallery-masonry {
                column-count: 2;
            }
        }
        @media (max-width: 640px) {
            .gallery-masonry {
                column-count: 1;
            }
        }
        .gallery-masonry .photo-card {
            break-inside: avoid;
            margin-bottom: 1.5rem;
        }
        .rose-gold-gradient {
            background: linear-gradient(135deg, #b76e79 0%, #c9a87c 100%);
        }
        .overlay-gradient {
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 50%);
        }
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #fdf6f0;
        }
        ::-webkit-scrollbar-thumb {
            background: #b76e79;
            border-radius: 4px;
        }
        /* Music Player Styling */
        .music-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50px;
            padding: 10px 20px;
            box-shadow: 0 10px 30px rgba(183, 110, 121, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .music-player.hidden {
            transform: translateY(100px);
            opacity: 0;
            pointer-events: none;
        }
        .music-player.visible {
            transform: translateY(0);
            opacity: 1;
        }
        .music-icon {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100px;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            outline: none;
        }
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #b76e79;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-rose-50 via-amber-50 to-rose-100 min-h-screen">
    
    <!-- Music Player (Fixed at bottom right) -->
    <div id="musicPlayer" class="music-player hidden">
        <div class="flex items-center gap-3">
            <button id="musicToggle" class="bg-rose-500 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-rose-600 transition">
                <i id="musicIcon" class="fas fa-pause"></i>
            </button>
            <div class="flex-1">
                <p class="text-sm font-medium text-rose-700">·â†·âÉ·äì ·ãò·åà·àä·àã</p>
                <p class="text-xs text-amber-600"></p>
            </div>
            <div class="flex items-center gap-2">
                <i class="fas fa-volume-low text-rose-400"></i>
                <input id="volumeSlider" type="range" min="0" max="100" value="50" class="volume-slider">
            </div>
            <button id="musicClose" class="text-gray-400 hover:text-rose-500">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Landing Page (Initial View) -->
    <div id="landingPage" class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-rose-50 via-amber-50 to-rose-100">
        <div class="absolute inset-0 overflow-hidden">
            <div class="sparkle" style="top: 20%; left: 10%; animation-delay: 0s;"></div>
            <div class="sparkle" style="top: 30%; left: 80%; animation-delay: 0.5s;"></div>
            <div class="sparkle" style="top: 60%; left: 20%; animation-delay: 1s;"></div>
            <div class="sparkle" style="top: 70%; left: 70%; animation-delay: 1.5s;"></div>
            <div class="sparkle" style="top: 40%; left: 50%; animation-delay: 0.8s;"></div>
        </div>
        <div class="text-center p-8 relative z-10">
            <div class="float-animation mb-6">
                <i class="fas fa-heart text-6xl md:text-8xl text-rose-400 heartbeat"></i>
            </div>
            <p class="text-rose-400 tracking-[0.3em] uppercase text-sm mb-4">The Wedding of</p>
            <h1 class="script-font text-5xl md:text-8xl text-rose-700 mb-2">·ãÆ·äí & ·àú·àä</h1>
            <p class="serif-font text-2xl md:text-3xl text-amber-700 mb-2">·àò·àµ·ä®·à®·àù 12 , 2017</p>
            <p class="text-rose-500 mb-8 serif-font text-lg"></p>
            <div class="flex items-center justify-center gap-4 mb-8">
                <div class="w-16 h-px bg-rose-300"></div>
                <i class="fas fa-ring text-amber-500"></i>
                <div class="w-16 h-px bg-rose-300"></div>
            </div>
            <button id="enterGalleryBtn" class="rose-gold-gradient text-white font-medium py-4 px-10 rounded-full text-lg transition transform hover:scale-105 hover:shadow-xl">
                <i class="fas fa-camera mr-2"></i> Enter Gallery
            </button>
            <!-- Music Toggle Button for Landing Page -->
            <div class="mt-8">
                <button id="landingMusicToggle" class="flex items-center gap-2 px-5 py-2 rounded-full border border-rose-300 text-rose-600 hover:bg-rose-50 transition">
                    <i id="landingMusicIcon" class="fas fa-music music-icon"></i>
                    <span id="landingMusicText">Play Music</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Gallery Content -->
    <div id="mainGallery" class="hidden">
        
        <!-- Combined Navigation Wrapper (Header + Category Filter) - Fixed and full width -->
        <div id="smartNavWrapper" class="fixed top-0 left-0 right-0 z-40">
            
            <!-- Header (Fixed Navigation) - White Background Applied Here -->
            <header class="bg-white/90 backdrop-blur-md shadow-lg">
                <div class="max-w-7xl mx-auto px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-heart text-rose-400 text-xl"></i>
                            <div>
                                <h1 class="script-font text-2xl md:text-3xl text-rose-700">·ãÆ·äí & ·àú·àä</h1>
                                <p class="text-xs text-amber-600 tracking-wider">·àò·àµ·ä®·à®·àù 12 , 2017</p>
                            </div>
                        </div>
                        <!-- Controls: Slideshow and Download All -->
                        <div class="flex items-center gap-3 md:gap-4 flex-wrap justify-end">
                            <button id="downloadAllBtn" class="flex items-center gap-2 px-3 md:px-4 py-2 bg-rose-400 text-white rounded-full hover:bg-rose-500 transition text-sm md:text-base">
                                <i class="fas fa-file-arrow-down"></i> Download All
                            </button>
                            <button id="slideshowBtn" class="flex items-center gap-2 px-3 md:px-4 py-2 border border-rose-300 text-rose-600 rounded-full hover:bg-rose-50 transition text-sm md:text-base">
                                <i class="fas fa-play"></i> Slideshow
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Category Filter - Transparent Background. Added classes for smooth transition. -->
            <section id="categoryNav" class="px-4 pb-4 pt-2 border-t border-rose-100/50 transition-all duration-300 ease-in-out max-h-96 opacity-100 overflow-hidden">
                <div class="max-w-7xl mx-auto">
                    <div class="flex flex-wrap justify-center gap-3">
                        <button class="category-btn active px-5 py-2 rounded-full border border-rose-300 text-rose-700 font-medium transition hover:bg-rose-100" data-category="all">
                            <i class="fas fa-th mr-2"></i>All Photos
                        </button>
                        <button class="category-btn px-5 py-2 rounded-full border border-rose-300 text-rose-700 font-medium transition hover:bg-rose-100" data-category="portraits">
                            <i class="fas fa-church mr-2"></i>·àΩ·àù·åç·àç·äì
                        </button>
                        <button class="category-btn px-5 py-2 rounded-full border border-rose-300 text-rose-700 font-medium transition hover:bg-rose-100" data-category="teklil">
                            <i class="fas fa-champagne-glasses mr-2"></i>·àµ·à≠·ä†·â∞ ·â∞·ä≠·àä·àç
                        </button>
                        <button class="category-btn px-5 py-2 rounded-full border border-rose-300 text-rose-700 font-medium transition hover:bg-rose-100" data-category="family">
                            <i class="fas fa-heart mr-2"></i>·àò·àç·àµ
                        </button>
                        <button class="category-btn px-5 py-2 rounded-full border border-rose-300 text-rose-700 font-medium transition hover:bg-rose-100" data-category="ceremony">
                            <i class="fas fa-users mr-2"></i>·ã®·àò·àµ·ä≠ ·çé·â∂
                        </button>
                      <button class="category-btn px-5 py-2 rounded-full border border-rose-300 text-rose-700 font-medium transition hover:bg-rose-100" data-category="reception">
                            <i class="fas fa-users mr-2"></i>Studio photo
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Hero Section - Padding handled dynamically by JS below the fixed navbar -->
        <section id="heroSection" class="pb-12 px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="script-font text-4xl md:text-6xl text-rose-700 mb-4">Our Wedding Gallery</h2>
                <p class="serif-font text-lg md:text-xl text-amber-700 mb-2">Forever & Always</p>
                <p class="text-gray-600 max-w-2xl mx-auto"></p>
            </div>
        </section>

        <!-- Photo Count -->
        <div class="max-w-7xl mx-auto px-4 mb-6">
            <p id="photoCount" class="text-gray-500 text-sm"></p>
        </div>

        <!-- Photo Gallery (Masonry) -->
        <section class="px-4 pb-16">
            <div id="photoGallery" class="max-w-7xl mx-auto gallery-masonry">
                <!-- Photos will be inserted here by JavaScript -->
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-white/80 backdrop-blur-sm py-8 text-center border-t border-rose-100">
            <div class="flex items-center justify-center gap-3 mb-4">
                <div class="w-12 h-px bg-rose-300"></div>
                <i class="fas fa-heart text-rose-400"></i>
                <div class="w-12 h-px bg-rose-300"></div>
            </div>
            <p class="script-font text-3xl text-rose-700 mb-2">·ãÆ·äí & ·àú·àä</p>
            <p class="text-amber-600 serif-font"></p>
            <p class="text-gray-400 text-sm mt-4">¬© 2017 Wedding Gallery</p>
        </footer>
    </div>

    <!-- Lightbox Modal -->
    <div id="lightboxModal" class="hidden fixed inset-0 bg-black/95 z-50 flex items-center justify-center">
        <button id="closeLightbox" class="absolute top-4 right-4 z-10 p-3 text-white/70 hover:text-white transition">
            <i class="fas fa-times text-2xl"></i>
        </button>
        <button id="prevPhoto" class="absolute left-4 top-1/2 -translate-y-1/2 p-4 text-white/70 hover:text-white transition">
            <i class="fas fa-chevron-left text-3xl"></i>
        </button>
        <button id="nextPhoto" class="absolute right-4 top-1/2 -translate-y-1/2 p-4 text-white/70 hover:text-white transition">
            <i class="fas fa-chevron-right text-3xl"></i>
        </button>
        <div class="max-w-6xl w-full px-4">
            <div class="relative">
                <img id="lightboxImage" src="" alt="" class="max-h-[80vh] mx-auto rounded-lg shadow-2xl">
            </div>
            <div class="text-center mt-6">
                <h3 id="lightboxTitle" class="text-xl font-medium text-white"></h3>
                <p id="lightboxCategory" class="text-rose-300 mt-1 capitalize"></p>
                <div class="flex justify-center gap-4 mt-4">
                    <!-- Like button was removed here -->
                    <button id="downloadBtn" class="flex items-center gap-2 px-4 py-2 bg-white/10 rounded-full text-white hover:bg-white/20 transition">
                        <i class="fas fa-download"></i> Download
                    </button>
                    <button id="shareBtn" class="flex items-center gap-2 px-4 py-2 bg-white/10 rounded-full text-white hover:bg-white/20 transition">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
        </div>
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2">
            <p id="photoIndex" class="text-white/50 text-sm"></p>
        </div>
    </div>

    <!-- Slideshow Modal -->
    <div id="slideshowModal" class="hidden fixed inset-0 bg-black z-50 flex items-center justify-center">
        <button id="closeSlideshow" class="absolute top-4 right-4 z-10 p-3 text-white/70 hover:text-white transition">
            <i class="fas fa-times text-2xl"></i>
        </button>
        <div class="w-full h-full flex items-center justify-center p-8">
            <img id="slideshowImage" src="" alt="" class="max-h-full max-w-full object-contain rounded-lg">
        </div>
        <div class="absolute bottom-8 left-1/2 -translate-x-1/2 flex items-center gap-4">
            <button id="slideshowPrev" class="p-3 bg-white/10 rounded-full text-white hover:bg-white/20 transition">
                <i class="fas fa-backward"></i>
            </button>
            <button id="slideshowPlayPause" class="p-4 bg-white/20 rounded-full text-white hover:bg-white/30 transition">
                <i class="fas fa-pause" id="playPauseIcon"></i>
            </button>
            <button id="slideshowNext" class="p-3 bg-white/10 rounded-full text-white hover:bg-white/20 transition">
                <i class="fas fa-forward"></i>
            </button>
        </div>
    </div>

    <!-- Audio Element for Background Music -->
    <audio id="backgroundMusic" loop>
        <!-- Using a royalty-free romantic piano music from a free source -->
        <source src="3.mp3" type="audio/mpeg">
        <source src="https://assets.mixkit.co/music/preview/mixkit-piano-romance-1104.wav" type="audio/wav">
        Your browser does not support the audio element.
    </audio>

    <script>
        // Wedding photos data
        let photos = [
            { id: 1, url: '1.jpg', caption: 'First Look', category: 'ceremony', likes: 124, height: 'tall' },
            { id: 2, url: '2.jpg', caption: 'Walking Down the Aisle', category: 'ceremony', likes: 89, height: 'normal' },
            { id: 3, url: '3.jpg', caption: 'The Kiss', category: 'ceremony', likes: 156, height: 'tall' },
            { id: 4, url: '4.jpg', caption: 'Wedding Rings', category: 'ceremony', likes: 67, height: 'normal' },
            { id: 5, url: '5.jpg', caption: 'Bride & Groom Portrait', category: 'ceremony', likes: 203, height: 'tall' },
            { id: 6, url: '6.jpg', caption: 'Beautiful Bouquet', category: 'ceremony', likes: 78, height: 'normal' },
            { id: 7, url: '7.jpg', caption: 'First Dance', category: 'ceremony', likes: 145, height: 'normal' },
            { id: 8, url: '8.jpg', caption: 'Cutting the Cake', category: 'ceremony', likes: 92, height: 'tall' },
            { id: 9, url: '9.jpg', caption: 'Family Photo', category: 'ceremony', likes: 118, height: 'normal' },
            { id: 10, url: '10.jpg', caption: 'Romantic Sunset', category: 'ceremony', likes: 187, height: 'tall' },
            { id: 11, url: '11.jpg', caption: 'Table Decorations', category: 'ceremony', likes: 54, height: 'normal' },
            { id: 12, url: '12.jpg', caption: 'Bridesmaids', category: 'ceremony', likes: 134, height: 'normal' },
            { id: 13, url: '13.jpg', caption: 'Exchange of Vows', category: 'ceremony', likes: 167, height: 'tall' },
            { id: 14, url: '14.jpg', caption: 'Party Time!', category: 'ceremony', likes: 98, height: 'normal' },
             { id: 15, url: '15.jpg', caption: 'First Look', category: 'reception', likes: 124, height: 'tall' },
            { id: 16, url: '16.jpg', caption: 'Walking Down the Aisle', category: 'reception', likes: 89, height: 'normal' },
            { id: 17, url: '17.jpg', caption: 'The Kiss', category: 'reception', likes: 156, height: 'tall' },
            { id: 18, url: '18.jpg', caption: 'Wedding Rings', category: 'reception', likes: 67, height: 'normal' },
            { id: 19, url: '19.jpg', caption: 'Bride & Groom Portrait', category: 'reception', likes: 203, height: 'tall' },
            { id: 20, url: '20.jpg', caption: 'Beautiful Bouquet', category: 'reception', likes: 78, height: 'normal' },
            { id: 21, url: '21.jpg', caption: 'First Dance', category: 'reception', likes: 145, height: 'normal' },
            { id: 22, url: '22.jpg', caption: 'Cutting the Cake', category: 'reception', likes: 92, height: 'tall' },
            { id: 23, url: '23.jpg', caption: 'Family Photo', category: 'reception', likes: 118, height: 'normal' },
            { id: 24, url: '24.jpg', caption: 'Romantic Sunset', category: 'reception', likes: 187, height: 'tall' },
            { id: 25, url: '25.jpg', caption: 'Table Decorations', category: 'reception', likes: 54, height: 'normal' },
            { id: 26, url: '26.jpg', caption: 'Bridesmaids', category: 'reception', likes: 134, height: 'normal' },
            { id: 27, url: '27.jpg', caption: 'Exchange of Vows', category: 'reception', likes: 167, height: 'tall' },
            { id: 28, url: '28.jpg', caption: 'First Look', category: 'portraits', likes: 124, height: 'tall' },
            { id: 29, url: '29.jpg', caption: 'Walking Down the Aisle', category: 'portraits', likes: 89, height: 'normal' },
            { id: 30, url: '30.jpg', caption: 'The Kiss', category: 'portraits', likes: 156, height: 'tall' },
            { id: 32, url: '31.jpg', caption: 'Wedding Rings', category: 'portraits', likes: 67, height: 'normal' },
            { id: 33, url: '32.jpg', caption: 'Bride & Groom Portrait', category: 'portraits', likes: 203, height: 'tall' },
            { id: 34, url: '33.jpg', caption: 'Beautiful Bouquet', category: 'portraits', likes: 78, height: 'normal' },
            { id: 35, url: '34.jpg', caption: 'First Dance', category: 'portraits', likes: 145, height: 'normal' },
            { id: 36, url: '35.jpg', caption: 'Cutting the Cake', category: 'portraits', likes: 92, height: 'tall' },
            { id: 37, url: '36.jpg', caption: 'Family Photo', category: 'portraits', likes: 118, height: 'normal' },
            { id: 38, url: '37.jpg', caption: 'Romantic Sunset', category: 'portraits', likes: 187, height: 'tall' },
            { id: 39, url: '38.jpg', caption: 'Table Decorations', category: 'portraits', likes: 54, height: 'normal' },
            { id: 40, url: '39.jpg', caption: 'Bridesmaids', category: 'portraits', likes: 134, height: 'normal' },
            { id: 41, url: '40.jpg', caption: 'Exchange of Vows', category: 'teklil', likes: 167, height: 'tall' },
            { id: 42, url: '41.jpg', caption: 'Party Time!', category: 'teklil', likes: 98, height: 'normal' },
             { id: 43, url: '42.jpg', caption: 'First Look', category: 'teklil', likes: 124, height: 'tall' },
            { id: 44, url: '43.jpg', caption: 'Walking Down the Aisle', category: 'teklil', likes: 89, height: 'normal' },
            { id: 45, url: '44.jpg', caption: 'The Kiss', category: 'teklil', likes: 156, height: 'tall' },
            { id: 46, url: '45.jpg', caption: 'Wedding Rings', category: 'teklil', likes: 67, height: 'normal' },
            { id: 47, url: '46.jpg', caption: 'Bride & Groom Portrait', category: 'teklil', likes: 203, height: 'tall' },
            { id: 49, url: '47.jpg', caption: 'Beautiful Bouquet', category: 'teklil', likes: 78, height: 'normal' },
            { id: 50, url: '48.jpg', caption: 'First Dance', category: 'teklil', likes: 145, height: 'normal' },
            { id: 51, url: '49.jpg', caption: 'Cutting the Cake', category: 'reception', likes: 92, height: 'tall' },
            { id: 52, url: '50.jpg', caption: 'Family Photo', category: 'family', likes: 118, height: 'normal' },
            { id: 53, url: '51.jpg', caption: 'Romantic Sunset', category: 'family', likes: 187, height: 'tall' },
            { id: 54, url: '52.jpg', caption: 'Table Decorations', category: 'family', likes: 54, height: 'normal' },
            { id: 55, url: '53.jpg', caption: 'Bridesmaids', category: 'family', likes: 134, height: 'normal' },
            { id: 56, url: '54.jpg', caption: 'Exchange of Vows', category: 'family', likes: 167, height: 'tall' },
            { id: 57, url: '55.jpg', caption: 'Cutting the Cake', category: 'family', likes: 92, height: 'tall' },
            { id: 58, url: '56.jpg', caption: 'Family Photo', category: 'family', likes: 118, height: 'normal' },
            { id: 59, url: '57.jpg', caption: 'Romantic Sunset', category: 'family', likes: 187, height: 'tall' },
            { id: 60, url: '58.jpg', caption: 'Table Decorations', category: 'family', likes: 54, height: 'normal' },
            { id: 61, url: '59.jpg', caption: 'Bridesmaids', category: 'family', likes: 134, height: 'normal' },
            { id: 62, url: '60.jpg', caption: 'Exchange of Vows', category: 'family', likes: 167, height: 'tall' },
             { id: 63, url: '61.jpg', caption: 'Table Decorations', category: 'family', likes: 54, height: 'normal' },
            { id: 64, url: '62.jpg', caption: 'Bridesmaids', category: 'family', likes: 134, height: 'normal' },
            { id: 65, url: '53.jpg', caption: 'Exchange of Vows', category: 'family', likes: 167, height: 'tall' },
           
        ];

        let currentCategory = 'all';
        let currentPhotoIndex = 0;
        let filteredPhotos = [...photos];
        let slideshowInterval = null;
        let isPlaying = true;
        
        // New Global Variables for scroll logic
        let lastScrollTop = 0;
        const scrollThreshold = 300; // Pixels scrolled down before hiding

        // DOM Elements
        const landingPage = document.getElementById('landingPage');
        const mainGallery = document.getElementById('mainGallery');
        const photoGallery = document.getElementById('photoGallery');
        const lightboxModal = document.getElementById('lightboxModal');
        const slideshowModal = document.getElementById('slideshowModal');
        const downloadAllBtn = document.getElementById('downloadAllBtn');
        const smartNavWrapper = document.getElementById('smartNavWrapper');
        const heroSection = document.getElementById('heroSection');
        const categoryNav = document.getElementById('categoryNav');
        
        // Music Elements
        const backgroundMusic = document.getElementById('backgroundMusic');
        const musicPlayer = document.getElementById('musicPlayer');
        const musicToggle = document.getElementById('musicToggle');
        const musicIcon = document.getElementById('musicIcon');
        const landingMusicToggle = document.getElementById('landingMusicToggle');
        const landingMusicIcon = document.getElementById('landingMusicIcon');
        const landingMusicText = document.getElementById('landingMusicText');
        const volumeSlider = document.getElementById('volumeSlider');
        const musicClose = document.getElementById('musicClose');

        // Set initial volume
        backgroundMusic.volume = 0.5; // 50% volume

        // --- Music Player Functions ---
        function toggleMusic() {
            if (backgroundMusic.paused) {
                backgroundMusic.play();
                musicIcon.className = 'fas fa-pause';
                landingMusicIcon.className = 'fas fa-pause music-icon';
                landingMusicText.textContent = 'Pause Music';
            } else {
                backgroundMusic.pause();
                musicIcon.className = 'fas fa-play';
                landingMusicIcon.className = 'fas fa-play music-icon';
                landingMusicText.textContent = 'Play Music';
            }
        }

        function updateVolume() {
            backgroundMusic.volume = volumeSlider.value / 100;
        }

        function showMusicPlayer() {
            musicPlayer.classList.remove('hidden');
            musicPlayer.classList.add('visible');
        }

        function hideMusicPlayer() {
            musicPlayer.classList.remove('visible');
            musicPlayer.classList.add('hidden');
        }

        // Start playing music when page loads (with user interaction requirement)
        function initializeMusic() {
            // Show music player on landing page
            setTimeout(() => {
                showMusicPlayer();
            }, 1000);
            
            // Try to play music automatically (some browsers require user interaction)
            const playPromise = backgroundMusic.play();
            
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Autoplay prevented. Waiting for user interaction.");
                    landingMusicText.textContent = 'Play Music';
                    landingMusicIcon.className = 'fas fa-play music-icon';
                    musicIcon.className = 'fas fa-play';
                });
            }
        }

        // Event Listeners for Music
        musicToggle.addEventListener('click', toggleMusic);
        landingMusicToggle.addEventListener('click', () => {
            toggleMusic();
            showMusicPlayer();
        });
        
        volumeSlider.addEventListener('input', updateVolume);
        
        musicClose.addEventListener('click', () => {
            hideMusicPlayer();
        });

        // Initialize music when page loads
        window.addEventListener('load', initializeMusic);

        // --- Permanent Header Logic: Calculate height and set content padding ---
        function setHeroPadding() {
            if (smartNavWrapper && heroSection && !mainGallery.classList.contains('hidden')) {
                const navHeight = smartNavWrapper.offsetHeight;
                // Add the calculated height plus a little extra for spacing
                heroSection.style.paddingTop = `${navHeight + 32}px`; 
            }
        }

        // Call the padding function on load and resize
        window.addEventListener('load', setHeroPadding);
        window.addEventListener('resize', setHeroPadding);
        // --- End Permanent Header Logic ---


        // Custom Message Box (Replaces alert/confirm)
        const showMessage = (message) => {
            const existingMsg = document.getElementById('messageBox');
            if (existingMsg) existingMsg.remove();

            const msgBox = document.createElement('div');
            msgBox.id = 'messageBox';
            msgBox.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-rose-600 text-white px-6 py-3 rounded-lg shadow-xl transition-opacity duration-300 z-[9999]';
            msgBox.textContent = message;
            document.body.appendChild(msgBox);
            
            setTimeout(() => {
                msgBox.style.opacity = '0';
                setTimeout(() => msgBox.remove(), 300);
            }, 3000);
        };

        // --- Auto Download Logic ---
        downloadAllBtn.addEventListener('click', () => {
            downloadAllPhotos();
        });

        function downloadPhoto(photo, index) {
            // Use a short delay (e.g., 500ms) to prevent the browser from blocking multiple downloads.
            setTimeout(() => {
                const link = document.createElement('a');
                link.href = photo.url;
                link.download = `S&M_Wedding_${photo.caption.replace(/\s+/g, '_')}_${photo.id}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }, index * 500); 
        }

        function downloadAllPhotos() {
            if (filteredPhotos.length === 0) {
                showMessage("No photos to download. Try selecting a category first.");
                return;
            }

            showMessage(`Starting download of ${filteredPhotos.length} photos. Please check your downloads folder!`);
            
            filteredPhotos.forEach((photo, index) => {
                downloadPhoto(photo, index);
            });
        }
        // --- End Auto Download Logic ---


        // Enter gallery
        document.getElementById('enterGalleryBtn').addEventListener('click', () => {
            landingPage.style.transition = 'opacity 1s ease';
            landingPage.style.opacity = '0';
            setTimeout(() => {
                landingPage.classList.add('hidden');
                mainGallery.classList.remove('hidden');
                setHeroPadding(); // Calculate and set padding when entering the gallery
                renderGallery();
                // Show music player in main gallery
                showMusicPlayer();
            }, 1000);
        });
        
        // --- Smart Scroll Logic to Hide Category Bar ---
        function handleScroll() {
            // Only run if the gallery is visible
            if (mainGallery.classList.contains('hidden')) return;
            
            const st = window.pageYOffset || document.documentElement.scrollTop;
            const isVisible = categoryNav.classList.contains('max-h-96');

            if (st > lastScrollTop && st > scrollThreshold) {
                // Scrolling Down past threshold: Hide the category bar
                if (isVisible) {
                    categoryNav.classList.remove('max-h-96', 'opacity-100', 'pb-4', 'pt-2');
                    categoryNav.classList.add('max-h-0', 'opacity-0', 'pb-0', 'pt-0', 'pointer-events-none');
                    // Recalculate padding after state change
                    setHeroPadding(); 
                }
            } else if (st <= 50) {
                // Scrolling Up to near the top: Show the category bar
                if (!isVisible) {
                    categoryNav.classList.add('max-h-96', 'opacity-100', 'pb-4', 'pt-2');
                    categoryNav.classList.remove('max-h-0', 'opacity-0', 'pb-0', 'pt-0', 'pointer-events-none');
                    // Recalculate padding after state change
                    setHeroPadding();
                }
            }
            
            lastScrollTop = st <= 0 ? 0 : st;
        }

        window.addEventListener('scroll', handleScroll);
        // --- End Smart Scroll Logic ---


        // Render gallery
        function renderGallery() {
            filteredPhotos = currentCategory === 'all' 
                ? [...photos] 
                : photos.filter(p => p.category === currentCategory);

            document.getElementById('photoCount').textContent = `${filteredPhotos.length} photos`;

            photoGallery.innerHTML = filteredPhotos.map((photo, index) => `
                <div class="photo-card cursor-pointer rounded-xl overflow-hidden bg-white shadow-lg" onclick="openLightbox(${photo.id})" style="animation: fadeIn 0.5s ease forwards; animation-delay: ${index * 0.05}s; opacity: 0;">
                    <div class="relative overflow-hidden ${photo.height === 'tall' ? 'aspect-[3/4]' : 'aspect-[4/3]'}">
                        <!-- Added onerror fallback for images -->
                        <img src="${photo.url}" alt="${photo.caption}" class="w-full h-full object-cover" 
                            onerror="this.onerror=null; this.src='https://placehold.co/800x600/b76e79/ffffff?text=Photo+Error'">
                    </div>
                </div>
            `).join('');
        }

        // Category filter
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCategory = btn.dataset.category;
                renderGallery();
            });
        });

        // Open lightbox
        function openLightbox(id) {
            const photo = photos.find(p => p.id === id);
            currentPhotoIndex = filteredPhotos.findIndex(p => p.id === id);
            
            document.getElementById('lightboxImage').src = photo.url;
            document.getElementById('lightboxTitle').textContent = photo.caption;
            document.getElementById('lightboxCategory').textContent = photo.category;
            document.getElementById('photoIndex').textContent = `${currentPhotoIndex + 1} of ${filteredPhotos.length}`;
            
            lightboxModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Close lightbox
        document.getElementById('closeLightbox').addEventListener('click', () => {
            lightboxModal.classList.add('hidden');
            document.body.style.overflow = '';
        });

        // Navigate photos
        document.getElementById('prevPhoto').addEventListener('click', () => {
            currentPhotoIndex = (currentPhotoIndex - 1 + filteredPhotos.length) % filteredPhotos.length;
            openLightbox(filteredPhotos[currentPhotoIndex].id);
        });

        document.getElementById('nextPhoto').addEventListener('click', () => {
            currentPhotoIndex = (currentPhotoIndex + 1) % filteredPhotos.length;
            openLightbox(filteredPhotos[currentPhotoIndex].id);
        });

        // Slideshow
        document.getElementById('slideshowBtn').addEventListener('click', () => {
            currentPhotoIndex = 0;
            updateSlideshowImage();
            slideshowModal.classList.remove('hidden');
            startSlideshow();
        });

        document.getElementById('closeSlideshow').addEventListener('click', () => {
            stopSlideshow();
            slideshowModal.classList.add('hidden');
        });

        function updateSlideshowImage() {
            document.getElementById('slideshowImage').src = filteredPhotos[currentPhotoIndex].url;
        }

        function startSlideshow() {
            isPlaying = true;
            document.getElementById('playPauseIcon').className = 'fas fa-pause';
            slideshowInterval = setInterval(() => {
                currentPhotoIndex = (currentPhotoIndex + 1) % filteredPhotos.length;
                updateSlideshowImage();
            }, 3000); // 3-second slide delay
        }

        function stopSlideshow() {
            isPlaying = false;
            document.getElementById('playPauseIcon').className = 'fas fa-play';
            clearInterval(slideshowInterval);
        }

        document.getElementById('slideshowPlayPause').addEventListener('click', () => {
            if (isPlaying) {
                stopSlideshow(); // Toggle off
            } else {
                startSlideshow(); // Toggle on
            }
        });

        document.getElementById('slideshowPrev').addEventListener('click', () => {
            stopSlideshow(); // Stop when manually navigating
            currentPhotoIndex = (currentPhotoIndex - 1 + filteredPhotos.length) % filteredPhotos.length;
            updateSlideshowImage();
        });

        document.getElementById('slideshowNext').addEventListener('click', () => {
            stopSlideshow(); // Stop when manually navigating
            currentPhotoIndex = (currentPhotoIndex + 1) % filteredPhotos.length;
            updateSlideshowImage();
        });

        // Close modals on outside click
        lightboxModal.addEventListener('click', (e) => {
            if (e.target === lightboxModal) {
                lightboxModal.classList.add('hidden');
                document.body.style.overflow = '';
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (!lightboxModal.classList.contains('hidden')) {
                if (e.key === 'ArrowLeft') document.getElementById('prevPhoto').click();
                if (e.key === 'ArrowRight') document.getElementById('nextPhoto').click();
                if (e.key === 'Escape') document.getElementById('closeLightbox').click();
            }
            if (!slideshowModal.classList.contains('hidden')) {
                if (e.key === 'Escape') document.getElementById('closeSlideshow').click();
                if (e.key === ' ') document.getElementById('slideshowPlayPause').click();
            }
        });

        // Download single photo
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const photo = filteredPhotos[currentPhotoIndex];
            // Re-using the utility function for single download
            downloadPhoto(photo, 0); 
            showMessage(`Downloading: ${photo.caption}`);
        });

        // Share photo 
        document.getElementById('shareBtn').addEventListener('click', async () => {
            const photo = filteredPhotos[currentPhotoIndex];

            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Wedding Photo',
                        text: photo.caption,
                        url: photo.url
                    });
                } catch (err) {
                    // Sharing failed or was cancelled
                    console.log('Share cancelled or failed:', err);
                }
            } else {
                // Fallback: Copy link to clipboard
                const input = document.createElement('input');
                input.value = photo.url;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                showMessage('Photo link copied to clipboard!');
            }
        });
    </script>
</body>
</html>
